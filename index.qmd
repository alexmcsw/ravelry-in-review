--- 
title: "Ravelry in Review"
author: "Alex McSween"
format: 
  dashboard:
    logo: images/logo.png
    nav-buttons: 
     - icon: github
       href: https://github.com/alexmcsw/ravelry-in-review
     - icon: activity
       href: https://www.ravelry.com/people/amcsw
    theme: 
        light: minty
        dark: cyborg
---

```{r}
library(jsonlite)
library(purrr)
library(dplyr)
library(ggplot2)
library(ggimage)
library(gt)

path <- "./data/json/projects/"
files <- dir(path, pattern = "*.json")

df <- data.frame()

for (file in files) {

  temp <- paste0(path,file) %>%
    fromJSON() %>%
    unlist() %>%
    as.matrix() %>%
    t() %>%
    as.data.frame()

  df <- dplyr::bind_rows(df, temp)
}

```

```{r}

open_projects <- df |> filter(status_name == "In progress") |> count() |> as.numeric()

completed_projects <- df |> filter(status_name == "Finished") |> count() |> as.numeric()

gift_projects <- df |> filter(!(made_for %in% c("me", "Me", "me!", "ME", "", NA))) |> count() |> as.numeric()

me_projects <- df |> filter((made_for %in% c("me", "Me", "me!", "ME", "", NA))) |> count() |> as.numeric()


```
## Row {height="20%"}

```{r}
#| content: valuebox
#| title: "Active WIPs"

list(
  icon = "file-medical",
  color = "secondary",
  value = open_projects
)
```

```{r}
#| content: valuebox
#| title: "Completed Projects"

list(
  icon = "file-medical",
  color = "light",
  value = completed_projects
)
```

```{r}
#| content: valuebox
#| title: "Gift ratio"

list(
  icon = "file-medical",
  color = "pink",
  value = gift_projects / me_projects
)
```

## Row {height=70%}
### Column {width=40%}
::: {.card}
## Most favourited project

```{r}

most_favourited <- df |> filter(favorites_count == max(favorites_count)) |> head(1)


images <- list.files(
    path = "data/photos/project",
    pattern = paste0(most_favourited |> select(permalink), "-\\d.jpg"),
    full.names = TRUE
)
```

```{r}

most_favourited |> 
    select(name, pattern_name, favorites_count) |>
    gt()
```

```{r}

ggplot() + geom_image(aes(x = 1,  y= 1, image = sample(images, 1)), size = 1) + theme_void()
```
:::

### Column {width=60%}
```{r}
print("hi")
```